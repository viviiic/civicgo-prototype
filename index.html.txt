<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicGo äº’å‹•åŸå‹ (ç°¡åŒ–ç‰ˆ)</title>
    <!-- è¼‰å…¥ Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Inter å­—å‹ --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Font Awesome åœ–ç¤ºåº« --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background-color: #E5E7EB; /* é é¢èƒŒæ™¯è‰² */
        }
        /* æ¨¡æ“¬æ‰‹æ©Ÿå¤–æ¡† */
        .mobile-shell {
            width: 414px; 
            max-width: 100%; 
            aspect-ratio: 9 / 16; 
            max-height: 90vh; 
            border-radius: 2.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            background-color: #f7fafc;
            display: flex;
            flex-direction: column;
        }
        .mobile-content {
             width: 100%;
             height: 100%;
             flex-grow: 1;
             display: flex;
             flex-direction: column;
             overflow: hidden; 
        }
        /* æ¨¡æ“¬ LINE MINI App çš„é ‚éƒ¨å°èˆªåˆ— */
        .mini-app-header {
            background-color: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0; 
        }
        /* éš±è—/é¡¯ç¤ºç•«é¢çš„ class */
        .page {
            display: none; 
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%; 
            flex-direction: column;
        }
        .page.active {
            display: flex; 
        }
        /* ä»»å‹™åœ–é‡˜çš„æ¨£å¼ */
        .task-pin {
            position: absolute;
            transform: translate(-50%, -50%); 
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid;
            backdrop-filter: blur(4px);
        }
        .task-pin:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        /* åº•éƒ¨å½ˆçª— */
        .bottom-sheet {
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        /* åŸå¸‚èŠ±åœ’çš„èŠ±æœµ */
        .flower {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s ease-out;
        }
        .flower.visible {
            opacity: 1;
            transform: scale(1);
        }
        
        /* åº•éƒ¨å°èˆªåˆ—æ¨£å¼ */
        .bottom-nav {
            flex-shrink: 0; 
            height: 65px; 
            padding-top: 8px;
            padding-bottom: 8px;
        }

        /* èŠ±åœ’èƒŒæ™¯æ¼¸è®Š */
        .garden-bg-gradient {
            background: linear-gradient(to bottom, #87CEEB, #A7D9ED); /* æ·ºè—è‰²å¤©ç©ºæ¼¸è®Š */
        }
    </style>
</head>
<body>

    <!-- æ¨¡æ“¬æ‰‹æ©Ÿå¤–æ¡† --><div class="mobile-shell">
        <div class="mobile-content"> 

            <!-- 
              ============================================================
              ç•«é¢ 1: å•Ÿå‹•ç•«é¢ (Splash Screen) & LINE Login
              ============================================================
            --><div id="page-splash" class="page active bg-white items-center justify-center text-center p-8 space-y-8">
                <div class="flex flex-col items-center">
                    <i class="fa-solid fa-map-location-dot fa-4x text-green-500"></i>
                    <h1 class="text-3xl font-bold text-gray-800 mt-4">CivicGo</h1>
                    <p class="text-lg text-gray-600 mt-2">è®“æ”¹è®Šï¼Œå¾å··å£é–‹å§‹</p>
                </div>
                
                <div class="w-full absolute bottom-16 left-0 px-8">
                    <button onclick="goToPage('page-map')" class="w-full bg-[#06C755] text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:bg-[#05b34b] transition-colors flex items-center justify-center space-x-2">
                        <i class="fa-brands fa-line fa-lg"></i>
                        <span>ä½¿ç”¨ LINE ç™»å…¥</span>
                    </button>
                    <p class="text-xs text-gray-500 mt-4 text-center">ç™»å…¥å³è¡¨ç¤ºæ‚¨åŒæ„æˆ‘å€‘çš„æœå‹™æ¢æ¬¾ã€‚</p>
                </div>
            </div>

            <!-- 
              ============================================================
              ç•«é¢ 2: ä¸»ç•«é¢ (åœ°åœ–ä»»å‹™)
              ============================================================
            --><div id="page-map" class="page">
                <!-- æ¨¡æ“¬ LINE MINI App é ‚éƒ¨ --><div class="mini-app-header w-full p-4 flex items-center justify-between shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800">CivicGo</h1>
                    <button onclick="goToPage('page-garden')" class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center shadow">
                        <i class="fa-solid fa-seedling fa-lg"></i>
                    </button>
                </div>
                
                <!-- åœ°åœ–å€åŸŸ - ä½¿ç”¨ SVG ç¤ºæ„åœ– --><div class="flex-grow relative w-full overflow-hidden bg-gray-200">
                    <!-- æŠ½è±¡ SVG è¡—é“åœ°åœ– --><svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 600">
                        <path d="M 50 0 V 600" stroke="#D1D5DB" stroke-width="15" fill="none"/>
                        <path d="M 150 0 V 600" stroke="#D1D5DB" stroke-width="10" fill="none"/>
                        <path d="M 300 0 V 300 H 400" stroke="#D1D5DB" stroke-width="12" fill="none"/>
                        <path d="M 300 400 V 600" stroke="#D1D5DB" stroke-width="8" fill="none"/>
                        <path d="M 0 100 H 400" stroke="#D1D5DB" stroke-width="10" fill="none"/>
                        <path d="M 0 300 H 250" stroke="#D1D5DB" stroke-width="15" fill="none"/>
                        <path d="M 0 500 H 400" stroke="#D1D5DB" stroke-width="12" fill="none"/>
                        <path d="M 120 180 Q 200 250 300 300" stroke="#E5E7EB" stroke-width="6" fill="none"/>
                        <path d="M 80 400 Q 150 450 200 550" stroke="#E5E7EB" stroke-width="6" fill="none"/>
                    </svg>
                    
                    <!-- ä½¿ç”¨è€…ç•¶å‰ä½ç½® --><div class="absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-md"></div>
                        <div class="w-4 h-4 bg-blue-500 rounded-full absolute top-0 left-0 animate-ping"></div>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 1: æ’¿åƒåœ¾ --><div class="task-pin border-red-500" style="top: 45%; left: 40%;" onclick="showTaskDetail('task1')">
                        <i class="fa-solid fa-trash-can fa-lg text-red-700"></i>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 2: æäºŒæ‰‹æ›¸ --><div class="task-pin border-blue-500" style="top: 60%; left: 65%;" onclick="showTaskDetail('task2')">
                        <i class="fa-solid fa-book fa-lg text-blue-700"></i>
                    </div>

                    <!-- ä»»å‹™åœ–é‡˜ 3: å‹Ÿé›†å†¬è¡£ --><div class="task-pin border-yellow-500" style="top: 25%; left: 55%;" onclick="showTaskDetail('task3')">
                        <i class="fa-solid fa-shirt fa-lg text-yellow-700"></i>
                    </div>
                </div>
                
                <!-- åº•éƒ¨å°èˆª --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top">
                    <button onclick="goToPage('page-map')" class="flex flex-col items-center justify-center text-green-600 w-1/3">
                        <i class="fa-solid fa-map-location-dot fa-lg"></i>
                        <span class="text-xs font-semibold mt-1">ä»»å‹™åœ°åœ–</span>
                    </button>
                    <button onclick="goToPage('page-ranking')" class="flex flex-col items-center justify-center text-gray-500 w-1/3">
                        <i class="fa-solid fa-chart-simple fa-lg"></i>
                        <span class="text-xs mt-1">æ’è¡Œæ¦œ</span>
                    </button>
                    <button onclick="showModal('modal-community-post')" class="flex flex-col items-center justify-center text-gray-500 w-1/3">
                        <i class="fa-solid fa-circle-plus fa-lg"></i>
                        <span class="text-xs mt-1">ç™¼å¸ƒéœ€æ±‚</span>
                    </button>
                </div>
            </div>

            <!-- 
              ============================================================
              ç•«é¢ 3: ä»»å‹™è©³æƒ… (åº•éƒ¨å½ˆçª—)
              ============================================================
            --><div id="modal-task-detail" class="page" style="display: none; background-color: rgba(0,0,0,0.5);" onclick="closeModal('modal-task-detail')">
                <div class="w-full bg-white rounded-t-2xl p-6 absolute bottom-0 bottom-sheet max-h-[70%] flex flex-col" onclick="event.stopPropagation()">
                    <div id="task-detail-content" class="overflow-y-auto"></div>
                    <div class="mt-6 flex space-x-4 flex-shrink-0">
                        <button onclick="closeModal('modal-task-detail')" class="w-1/3 bg-gray-200 text-gray-700 font-semibold py-3 rounded-lg">å†çœ‹çœ‹</button>
                        <button id="accept-task-btn" class="w-2/3 bg-green-500 text-white font-semibold py-3 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                            æ¥å—ä»»å‹™
                        </button>
                    </div>
                </div>
            </div>

            <!-- 
              ============================================================
              ç•«é¢ 4: ä»»å‹™é©—è­‰ (æ¨¡æ“¬ç›¸æ©Ÿ)
              ============================================================
            --><div id="page-validation" class="page bg-gray-900 items-center justify-center text-white p-4">
                
                <!-- é©—è­‰ä¸­è®€å–ç•«é¢ --><div id="ai-verifying" class="absolute inset-0 bg-gray-900/90 backdrop-blur-sm flex-col items-center justify-center" style="display: none; z-index: 20;">
                    <!-- ã€åˆªé™¤ã€‘Gemini Loader --><p class="mt-4 text-gray-200 font-semibold text-lg">ğŸ“¸ æ­£åœ¨é©—è­‰æ‚¨çš„è²¢ç»...</p>
                </div>

                <!-- æ‹ç…§ä»‹é¢ --><div class="w-full text-center absolute top-16">
                    <h2 class="text-2xl font-semibold">ä»»å‹™é©—è­‰</h2>
                    <p class="text-lg text-gray-300 mt-2">è«‹æ‹æ”æ‚¨æ”¶é›†çš„åƒåœ¾è¢‹</p>
                </div>
                
                <div class="w-full aspect-square bg-gray-700 rounded-lg flex items-center justify-center text-gray-500">
                    <i class="fa-solid fa-camera fa-7x"></i>
                </div>

                <div class="w-full absolute bottom-16 left-0 px-8 flex justify-around items-center">
                    <button onclick="goToPage('page-map')" class="text-white font-medium">å–æ¶ˆ</button>
                    <button onclick="showAIVerification('task1')" class="w-20 h-20 bg-white rounded-full border-4 border-gray-300 shadow-xl"></button>
                    <button class="text-white font-medium opacity-0">åˆ‡æ›</button>
                </div>
            </div>

            <!-- 
              ============================================================
              ç•«é¢ 5: ä»»å‹™æˆåŠŸ - åˆ†äº«è‡³ VOOM
              ============================================================
            --><div id="page-success" class="page bg-white items-center justify-center text-center p-8 space-y-6">
                <i class="fa-solid fa-circle-check fa-7x text-green-500"></i>
                
                <h1 class="text-3xl font-bold text-gray-800">ä»»å‹™å®Œæˆï¼</h1>
                <p class="text-lg text-gray-600">æ­å–œï¼æ‚¨ç²å¾—äº† <span id="reward-points" class="font-bold text-green-600"></span> é»ç©åˆ†ã€‚</p>
                <div class="w-full max-w-xs">
                    <img src="https://placehold.co/300x200/c6f6d5/2f855a?text=Growing+Flower" 
                         alt="ç”Ÿé•·ä¸­çš„èŠ±æœµ" class="rounded-lg shadow-lg">
                    <p class="text-lg font-semibold text-gray-700 mt-4">æ‚¨çš„ã€ŒåŸå¸‚èŠ±åœ’ã€é•·å‡ºäº†ä¸€æœµæ–°çš„èŠ±ï¼</p>
                </div>
                
                <div class="w-full absolute bottom-16 left-0 px-8 space-y-4">
                    <button onclick="goToPage('page-garden')" class="w-full bg-green-500 text-white font-semibold py-4 px-6 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                        æŸ¥çœ‹æˆ‘çš„èŠ±åœ’
                    </button>
                    <button onclick="showSimpleAlert('å·²åˆ†äº«è‡³ LINE VOOM (æ¨¡æ“¬)')" class="w-full bg-white text-[#06C755] border-2 border-[#06C755] font-semibold py-3 px-6 rounded-lg flex items-center justify-center space-x-2">
                        <i class="fa-brands fa-line fa-lg"></i>
                        <span>åˆ†äº«è‡³ LINE VOOM</span>
                    </button>
                    <button onclick="goToPage('page-map')" class="w-full bg-gray-100 text-gray-700 font-semibold py-3 px-6 rounded-lg">
                        å°‹æ‰¾ä¸‹ä¸€å€‹ä»»å‹™
                    </button>
                </div>
            </div>
            
            <!-- 
              ============================================================
              ç•«é¢ 6: æˆ‘çš„èŠ±åœ’ (Profile) - å¯æ²å‹•å…§å®¹
              ============================================================
            --><div id="page-garden" class="page bg-gray-50">
                <!-- é ‚éƒ¨å°èˆª --><div class="mini-app-header w-full p-4 flex items-center shadow-sm">
                    <button onclick="goToPage('page-map')" class="p-2 text-gray-600">
                        <i class="fa-solid fa-chevron-left fa-lg"></i>
                    </button>
                    <h1 class="text-xl font-bold text-gray-800 text-center flex-grow">æˆ‘çš„åŸå¸‚èŠ±åœ’</h1>
                </div>

                <!-- å¯æ²å‹•çš„ wrapper --><div class="flex-grow overflow-y-auto pb-6"> 

                    <!-- æ•¸æ“šçµ±è¨ˆ - æ–°å¢ä¿¡ç”¨ç©åˆ† --><div class="p-6">
                        <div class="bg-white rounded-lg shadow-lg p-6 flex justify-around text-center">
                            <div>
                                <p class="text-sm text-gray-500">ç¸½ç©åˆ†</p>
                                <p id="garden-total-points" class="text-3xl font-bold text-green-600">0</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">å·²å®Œæˆä»»å‹™</p>
                                <p id="garden-tasks-completed" class="text-3xl font-bold text-gray-800">0</p>
                            </div>
                            <!-- æ–°å¢ä¿¡ç”¨ç©åˆ† --><div>
                                <p class="text-sm text-gray-500">ä¿¡ç”¨ç©åˆ†</p>
                                <p id="garden-trust-score" class="text-3xl font-bold text-blue-600">100</p>
                            </div>
                        </div>
                    </div>

                    <!-- èŠ±åœ’è¦–è¦ºåŒ– --><div class="p-6 pt-0 flex flex-col items-center justify-center bg-green-50 rounded-t-2xl m-4 mt-0 shadow-inner">
                        <p class="text-lg font-semibold text-gray-700 mb-4">æ—åŒå­¸çš„èŠ±åœ’</p>
                        <!-- ã€ä¿®æ­£ã€‘ä½¿ç”¨ SVG æ›¿æ›ç©ºç™½èƒŒæ™¯ & åŠ å…¥åŸå¸‚å…ƒç´  --><div class="w-full h-64 rounded-lg flex items-end justify-center space-x-4 overflow-hidden relative p-4 garden-bg-gradient">
                            
                            <!-- ç°¡ç´„åŸå¸‚å¤©éš›ç·š SVG --><svg class="absolute bottom-0 left-0 w-full h-24 z-0" viewBox="0 0 400 100" preserveAspectRatio="none">
                                <rect x="0" y="50" width="400" height="50" fill="#6B7280"/>
                                <rect x="30" y="30" width="30" height="70" fill="#4B5563"/>
                                <rect x="80" y="40" width="40" height="60" fill="#4B5563"/>
                                <rect x="150" y="20" width="25" height="80" fill="#4B5563"/>
                                <rect x="200" y="60" width="50" height="40" fill="#4B5563"/>
                                <rect x="280" y="10" width="35" height="90" fill="#4B5563"/>
                                <rect x="340" y="35" width="45" height="65" fill="#4B5563"/>
                            </svg>

                            <!-- ç°¡ç´„çŒæœ¨å¢ SVG --><svg class="absolute bottom-16 left-5 w-24 h-16 z-0" viewBox="0 0 100 100" fill="#34D399">
                                <circle cx="30" cy="70" r="20"/>
                                <circle cx="70" cy="70" r="20"/>
                                <circle cx="50" cy="50" r="30"/>
                            </svg>
                            <svg class="absolute bottom-14 right-10 w-20 h-14 z-0" viewBox="0 0 100 100" fill="#34D399">
                                <circle cx="30" cy="70" r="18"/>
                                <circle cx="70" cy="70" r="18"/>
                                <circle cx="50" cy="50" r="25"/>
                            </svg>
                            
                            <div id="flower-container" class="relative z-10 flex items-end h-full w-full justify-around">
                                <!-- ã€ç§»é™¤ã€‘é è¨­å°å¹¼è‹—ï¼Œæ”¹ç‚ºå‹•æ…‹æ–°å¢ --></div>
                        </div>
                    </div>

                    <!-- çå‹µå…Œæ› - å¼·åŒ– LINE Points --><div class="bg-white p-6 shadow-inner-top mt-4 mx-4 rounded-lg"> 
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">çå‹µå…Œæ›</h3>
                        <div class="space-y-4">
                            <button class="w-full bg-[#06C755] text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-between shadow">
                                <span><i class="fa-brands fa-line fa-lg mr-2"></i>å…Œæ› 50 é» LINE POINTS</span>
                                <span class="bg-white text-green-600 text-sm font-bold px-2 py-1 rounded">500 ç©åˆ†</span>
                            </button>
                            <button class="w-full bg-yellow-500 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-between shadow">
                                <span><i class="fa-solid fa-store mr-2"></i>å…Œæ› åœ¨åœ°å•†å®¶å’–å•¡åˆ¸</span>
                                <span class="bg-white text-yellow-800 text-sm font-bold px-2 py-1 rounded">300 ç©åˆ†</span>
                            </button>
                        </div>
                    </div>
                
                </div> <!-- çµæŸå¯æ²å‹•çš„ wrapper --></div>

            <!-- 
              ============================================================
              ç•«é¢ 7: ç¤¾å€ç«¯ (ç™¼å¸ƒéœ€æ±‚å½ˆçª—) - ã€åˆªé™¤ AI åŠŸèƒ½ã€‘
              ============================================================
            --><div id="modal-community-post" class="page" style="display: none; background-color: rgba(0,0,0,0.5);" onclick="closeModal('modal-community-post')">
                <div class="w-full bg-white rounded-t-2xl p-6 absolute bottom-0 bottom-sheet max-h-[85%] flex flex-col" onclick="event.stopPropagation()">
                    <div class="flex justify-between items-center mb-4 flex-shrink-0">
                        <h2 class="text-xl font-bold text-gray-800">ç™¼å¸ƒç¤¾å€éœ€æ±‚</h2>
                        <button onclick="closeModal('modal-community-post')" class="text-gray-500"><i class="fa-solid fa-xmark fa-lg"></i></button>
                    </div>

                    <!-- å¯æ²å‹•çš„è¡¨å–®å€åŸŸ --><div class="overflow-y-auto">
                        <!-- ã€åˆªé™¤ã€‘æ­¥é©Ÿ 1 (AI æ­¥é©Ÿ) --><!-- æ­¥é©Ÿ 2 æ”¹ç‚ºé è¨­é¡¯ç¤º --><div id="manual-form-step">
                            <form onsubmit="event.preventDefault(); showCommunitySuccess();">
                                <div class="space-y-4">
                                    <div>
                                        <label for="task-title" class="text-sm font-medium text-gray-700">ä»»å‹™æ¨™é¡Œ</label>
                                        <input type="text" id="task-title" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šâœ¨ é€±æœ«æ·¨ç˜ç¥éšŠå‹å‹Ÿé›†ï¼">
                                    </div>
                                    <div>
                                        <label for="task-description" class="text-sm font-medium text-gray-700">ä»»å‹™æè¿°</label>
                                        <textarea id="task-description" rows="4" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šæˆ‘å€‘éœ€è¦ 5 ä½å¤¥ä¼´ï¼Œå”åŠ©æ¸…ç†æµ·ç˜..."></textarea>
                                    </div>
                                    <div class="flex space-x-4">
                                        <div class="w-1/2">
                                            <label for="task-location" class="text-sm font-medium text-gray-700">ä»»å‹™åœ°é»</label>
                                            <input type="text" id="task-location" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼šé€²å¾·è·¯å®‰å…¨å³¶">
                                        </div>
                                        <div class="w-1/2">
                                            <label for="task-time" class="text-sm font-medium text-gray-700">æ—¥æœŸæ™‚é–“</label>
                                            <input type="text" id="task-time" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š11/20 ä¸‹åˆ2é»">
                                        </div>
                                    </div>
                                    <div class="flex space-x-4">
                                        <div class="w-1/2">
                                            <label for="task-people" class="text-sm font-medium text-gray-700">éœ€æ±‚äººæ•¸</label>
                                            <input type="number" id="task-people" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š5">
                                        </div>
                                        <div class="w-1/2">
                                            <label for="task-reward" class="text-sm font-medium text-gray-700">çå‹µç©åˆ†</gabel>
                                            <input type="number" id="task-reward" class="w-full mt-1 p-2 border border-gray-300 rounded-lg" placeholder="ä¾‹å¦‚ï¼š50">
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="w-full bg-green-500 text-white font-semibold py-3 rounded-lg shadow-lg hover:bg-green-600 transition-colors">
                                        ç¢ºèªç™¼å¸ƒ
                                    </button>
                                    <!-- ã€åˆªé™¤ã€‘è¿”å›æŒ‰éˆ• --></div>
                            </form>
                        </div>
                    </div> <!-- çµæŸå¯æ²å‹•çš„è¡¨å–® --></div>
            </div>
            
            <!-- 
              ============================================================
              ç•«é¢ 8: (æ–°å¢) ç¤¾å€è²¢ç»æ’è¡Œæ¦œ
              ============================================================
            --><div id="page-ranking" class="page bg-gray-50">
                <!-- é ‚éƒ¨å°èˆª --><div class="mini-app-header w-full p-4 flex items-center shadow-sm">
                    <h1 class="text-xl font-bold text-gray-800 text-center flex-grow">ç¤¾å€è²¢ç»æ’è¡Œæ¦œ</h1>
                </div>

                <!-- æ’è¡Œæ¦œåˆ—è¡¨ --><div class="flex-grow p-6 space-y-4 overflow-y-auto">
                    <!-- é€™æ˜¯æ‚¨ --><div class="bg-white border-2 border-green-500 rounded-lg shadow-lg p-4 flex items-center space-x-4">
                        <span class="text-2xl font-bold text-green-600">3</span>
                        <img src="https://placehold.co/50x50/c6f6d5/2f855a?text=You" alt="Your Avatar" class="w-12 h-12 rounded-full">
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800">æ—åŒå­¸ (æ‚¨)</p>
                            <p class="text-sm text-gray-500">å·²å®Œæˆ 1 ä»¶ä»»å‹™</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold text-green-600" id="ranking-your-points">10</p>
                            <p class="text-xs text-gray-500">ç©åˆ†</p>
                        </div>
                    </div>
                    
                    <!-- å…¶ä»–äºº --><div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                        <span class="text-2xl font-bold text-gray-700">1</span>
                        <img src="https://placehold.co/50x50/e0e7ff/4338ca?text=A" alt="Avatar" class="w-12 h-12 rounded-full">
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800">ChanghuaHero</p>
                            <p class="text-sm text-gray-500">å·²å®Œæˆ 12 ä»¶ä»»å‹™</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold text-gray-800">350</p>
                            <p class="text-xs text-gray-500">ç©åˆ†</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                        <span class="text-2xl font-bold text-gray-700">2</span>
                        <img src="https://placehold.co/50x50/fef3c7/b45309?text=B" alt="Avatar" class="w-12 h-12 rounded-full">
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800">CivicLover</p>
                            <p class="text-sm text-gray-500">å·²å®Œæˆ 8 ä»¶ä»»å‹™</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold text-gray-800">210</p>
                            <p class="text-xs text-gray-500">ç©åˆ†</p>
                        </div>
                    </div>

                </div>

                <!-- åº•éƒ¨å°èˆª --><div class="bottom-nav w-full bg-white flex justify-around items-center border-t border-gray-200 shadow-inner-top">
                    <button onclick="goToPage('page-map')" class="flex flex-col items-center justify-center text-gray-500 w-1/3">
                        <i class="fa-solid fa-map-location-dot fa-lg"></i>
                        <span class="text-xs mt-1">ä»»å‹™åœ°åœ–</span>
                    </button>
                    <button onclick="goToPage('page-ranking')" class="flex flex-col items-center justify-center text-green-600 w-1/3">
                        <i class="fa-solid fa-chart-simple fa-lg"></i>
                        <span class="text-xs font-semibold mt-1">æ’è¡Œæ¦œ</span>
                    </button>
                    <button onclick="showModal('modal-community-post')" class="flex flex-col items-center justify-center text-gray-500 w-1/3">
                        <i class="fa-solid fa-circle-plus fa-lg"></i>
                        <span class="text-xs mt-1">ç™¼å¸ƒéœ€æ±‚</span>
                    </button>
                </div>
            </div>
            
            <!-- 
              ============================================================
              ç•«é¢ 9: (éš±è—) ç¤¾å€ç™¼å¸ƒæˆåŠŸ
              ============================================================
            --><div id="modal-community-success" class="page" style="display: none; background-color: rgba(0,0,0,0.5);" onclick="closeModal('modal-community-success'); goToPage('page-map');">
                <div class="m-auto bg-white rounded-lg shadow-lg p-8 w-11/12 text-center" onclick="event.stopPropagation()">
                    <i class="fa-solid fa-circle-check fa-5x text-green-500 mx-auto"></i>
                    <h2 class="text-2xl font-bold text-gray-800 mt-4">ç™¼å¸ƒæˆåŠŸï¼</h2>
                    <p class="text-gray-600 mt-2">ã€Œé€±æœ«æ·¨ç˜æ´»å‹•ã€å·²ç™¼é€çµ¦é™„è¿‘çš„é„°é‡Œè‹±é›„ã€‚</p>
                    <button onclick="closeModal('modal-community-success'); goToPage('page-map');" class="mt-6 w-full bg-green-500 text-white font-semibold py-3 rounded-lg">
                        å¤ªå¥½äº†
                    </button>
                </div>
            </div>

            <!-- ã€æ–°å¢ã€‘è‡ªå®šç¾©æç¤ºæ¡† --><div id="custom-alert" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl p-8 w-11/12 text-center" style="display: none; z-index: 999;">
                <p id="custom-alert-message" class="text-gray-700 text-lg">è¨Šæ¯</p>
                <button onclick="closeSimpleAlert()" class="mt-6 w-full bg-green-500 text-white font-semibold py-2 rounded-lg">
                    ç¢ºèª
                </button>
            </div>
            <div id="alert-overlay" class="absolute inset-0 bg-black/40" style="display: none; z-index: 998;" onclick="closeSimpleAlert()"></div>

        </div> <!-- çµæŸ .mobile-content --></div> <!-- çµæŸ .mobile-shell --><script>
        // --- å…¨åŸŸç‹€æ…‹ç®¡ç† (æ¨¡æ“¬) ---
        let currentPoints = 0;
        let tasksCompleted = 0;
        let flowersInGarden = [];
        let trustScore = 100; 

        // --- ä»»å‹™è³‡æ–™åº« (æ¨¡æ“¬) ---
        const taskDatabase = {
            'task1': {
                title: 'éš¨æ‰‹æ’¿åƒåœ¾',
                type: 'ä»»å‹™å°å‘',
                location: 'é€²å¾·è·¯å®‰å…¨å³¶ (è·é›¢ 50m)',
                description: 'å”åŠ©æ¸…ç†è©²å€åŸŸçš„å¡‘è† ç“¶èˆ‡ç´™å±‘ã€‚ç’°å¢ƒéœ€è¦ä½ æˆ‘å…±åŒå®ˆè­·ï¼',
                validation: 'AI åœ–åƒè¾¨è­˜',
                reward: 10
            },
            'task2': {
                title: 'æè´ˆäºŒæ‰‹æ›¸ (7æˆæ–°)',
                type: 'è³‡æºå°å‘',
                location: 'å½°åŒ–å¸«å¤§åœ–æ›¸é¤¨ (è·é›¢ 200m)',
                description: 'è®“çŸ¥è­˜æµå‹•ï¼åœ–æ›¸é¤¨æ­£ç‚ºåé„‰å‹Ÿé›†å…’ç«¥è®€ç‰©ã€‚',
                validation: 'æ«ƒå°äººå“¡æƒç¢¼',
                reward: 20
            },
            'task3': {
                title: 'å‹Ÿé›†äºŒæ‰‹å†¬è¡£ (NPO)',
                type: 'ç¤¾å€éœ€æ±‚',
                location: 'å½°å¸«å¤§ç‰¹æ•™ç³»è¾¦ (è·é›¢ 150m)',
                description: 'ç‚ºç¨å±…é•·è€…å‹Ÿé›†äºŒæ‰‹ä¿æš–å†¬è¡£ï¼Œæ‚¨çš„æ„›å¿ƒæ˜¯å†¬æ—¥è£¡æœ€æš–çš„é™½å…‰ã€‚',
                validation: 'å¿—å·¥ç¢ºèª',
                reward: 30
            }
        };

        // --- ã€åˆªé™¤ã€‘Gemini API ç›¸é—œ ---

        // --- é é¢å°èˆª ---
        let currentPage = 'page-splash';

        function goToPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.add('active');
                    if (pageId === 'page-garden') {
                        updateGardenStats();
                    }
                    if (pageId === 'page-ranking') {
                        document.getElementById('ranking-your-points').innerText = currentPoints;
                    }
                } else {
                    page.classList.remove('active');
                }
            });
            currentPage = pageId;
        }

        // --- å½ˆçª— (Modal) æ§åˆ¶ ---
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- è‡ªå®šç¾©æç¤ºæ¡† (å–ä»£ alert) ---
        function showSimpleAlert(message) {
            document.getElementById('custom-alert-message').innerText = message;
            document.getElementById('custom-alert').style.display = 'block';
            document.getElementById('alert-overlay').style.display = 'block';
        }
        function closeSimpleAlert() {
            document.getElementById('custom-alert').style.display = 'none';
            document.getElementById('alert-overlay').style.display = 'none';
        }
        window.alert = showSimpleAlert;


        // --- æ ¸å¿ƒæµç¨‹ ---

        // 1. é¡¯ç¤ºä»»å‹™è©³æƒ…
        function showTaskDetail(taskId) {
            const task = taskDatabase[taskId];
            if (!task) return;

            const contentEl = document.getElementById('task-detail-content');
            contentEl.innerHTML = `
                <span class="inline-block bg-green-100 text-green-700 text-xs font-semibold px-2 py-1 rounded-full mb-2">${task.type}</span>
                <h2 class="text-2xl font-bold text-gray-800">${task.title}</h2>
                <p class="text-gray-600 mt-2">${task.location}</p>
                <p class="text-gray-700 mt-4">${task.description}</p>
                <div class="mt-4 bg-gray-50 p-3 rounded-lg">
                    <p class="text-sm font-medium text-gray-700">é©—è­‰æ–¹å¼ï¼š<span class="font-normal text-gray-600">${task.validation}</span></p>
                    <p class="text-sm font-medium text-gray-700 mt-1">é è¨ˆçå‹µï¼š<span class="font-bold text-green-600">${task.reward} ç©åˆ†</span></p>
                </div>
            `;
            
            const acceptBtn = document.getElementById('accept-task-btn');
            if (taskId === 'task1') { // æ’¿åƒåœ¾ä»»å‹™
                acceptBtn.onclick = () => {
                    closeModal('modal-task-detail');
                    goToPage('page-validation');
                };
            } else { // å…¶ä»–ä»»å‹™
                acceptBtn.onclick = () => {
                    showValidationResult(taskId); 
                };
            }

            showModal('modal-task-detail');
        }

        // é¡¯ç¤º AI é©—è­‰è®€å–
        function showAIVerification(taskId) {
            const verifyingEl = document.getElementById('ai-verifying');
            verifyingEl.style.display = 'flex'; // é¡¯ç¤ºè®€å–å‹•ç•«

            // æ¨¡æ“¬ AI é©—è­‰ 2 ç§’
            setTimeout(() => {
                verifyingEl.style.display = 'none'; // éš±è—è®€å–å‹•ç•«
                showValidationResult(taskId); // é¡¯ç¤ºæˆåŠŸé é¢
            }, 2000);
        }


        // 2. é¡¯ç¤ºé©—è­‰çµæœ (ä»»å‹™æˆåŠŸ)
        function showValidationResult(taskId) {
            const task = taskDatabase[taskId];
            if (!task) return;

            // æ›´æ–°å…¨åŸŸç‹€æ…‹
            currentPoints += task.reward;
            tasksCompleted += 1;
            trustScore += 5; 
            flowersInGarden.push(getRandomFlower()); 

            document.getElementById('reward-points').innerText = task.reward;
            
            closeModal('modal-task-detail'); 
            goToPage('page-success'); 
        }

        // 3. æ›´æ–°èŠ±åœ’é é¢
        function updateGardenStats() {
            document.getElementById('garden-total-points').innerText = currentPoints;
            document.getElementById('garden-tasks-completed').innerText = tasksCompleted;
            document.getElementById('garden-trust-score').innerText = trustScore; 

            const container = document.getElementById('flower-container');
            container.innerHTML = ''; // æ¸…ç©ºï¼Œé‡æ–°ç¹ªè£½

            // èª¿æ•´èŠ±æœµä½ç½®ï¼Œè®“å®ƒå€‘åœ¨åŸå¸‚å¤©éš›ç·šä¹‹ä¸Š
            flowersInGarden.forEach((flowerSVG, index) => {
                const flowerEl = document.createElement('div');
                flowerEl.className = 'flower absolute'; // ä½¿ç”¨ absolute å®šä½
                // èª¿æ•´ top å±¬æ€§ä»¥æ”¾ç½®åœ¨çŒæœ¨å¢ä¹‹ä¸Šï¼Œå·¦å³åˆ†æ•£
                const leftPosition = 15 + (index % 5) * 15; // éš¨æ©Ÿåˆ†æ•£åœ¨å¯¬åº¦å…§
                const bottomPosition = 60 + (index % 3) * 10; // é«˜åº¦ä¹Ÿéš¨æ©Ÿèª¿æ•´
                flowerEl.style.cssText = `
                    left: ${leftPosition}%; 
                    bottom: ${bottomPosition}px; 
                    transform: translateX(-50%) scale(0.5);
                `;
                flowerEl.innerHTML = flowerSVG;
                container.appendChild(flowerEl);

                setTimeout(() => {
                    flowerEl.classList.add('visible');
                    flowerEl.style.transform = `translateX(-50%) scale(1)`; // è®“èŠ±æœµé•·å¤§
                }, 100 * index);
            });
        }
        
        // --- ã€åˆªé™¤ã€‘Gemini API ç›¸é—œåŠŸèƒ½ ---

        // ã€æ–°å¢ã€‘é‡è¨­æ‰‹å‹•è¡¨å–®
        function resetManualForm() {
            const fields = ['task-title', 'task-description', 'task-location', 'task-time', 'task-people', 'task-reward'];
            fields.forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function showCommunitySuccess() {
            closeModal('modal-community-post');
            showModal('modal-community-success');
            setTimeout(resetManualForm, 500); // é—œé–‰æ™‚é‡è¨­è¡¨å–®
        }

        function getRandomFlower() {
            const colors = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6']; 
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // æ›´ç°¡ç´„çš„èŠ±æœµ SVG
            return `
                <svg class="w-10 h-10" viewBox="0 0 100 100" fill="${color}" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="20" opacity="0.8"/>
                    <circle cx="50" cy="50" r="10" fill="#FDE047"/>
                    <rect x="48" y="70" width="4" height="20" fill="#10B981"/>
                </svg>
            `;
        }

    </script>

</body>
</html>
